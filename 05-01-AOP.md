## 1、AOP基本概念

### 1.1、什么是AOP

AOP：（Aspect Oriented Programming）面向切面编程

Spring IoC 容器不依赖与 AOP，如果不需要可以不导入 AOP 相关包

<br>

### 1.2、AOP与OOP区别

AOP 与 OOP（Object Oriented Programming）面向对象编程，编程模式不同，编程思想不同。

#### 1.2.1、面向目标不同：

简单来说 OOP 是面向名词领域，AOP 是面向动词领域

<br>

#### 1.2.2、思想结构不同：

OOP 是纵向结构，AOP 是横向结构

<br>

#### 1.2.3、注重方面不同：

OOP 注重业务逻辑单元的划分，AOP 偏重业务处理过程的某个步骤或者阶段

<br>

#### 1.2.4、AOP与OOP联系

两者之间是一个互补和完善的关系

<br>

1.2.5、AOP的优势

利用 AOP 可以对业务的各个部分进行隔离，从而使得业务逻辑各个部分之间的耦合度降低，提高程序的可重用性，同时提高开发效率

<br>

<br>

## 2、Spring AOP提供了两种模式

* 基于 XML 模式

* 基于 @AspectJ 注解模式

<br>

<br>

## 3、基于Spring AOP的重要应用

* 用 AOP 声明性事务代替 EJB 的企业服务
* 用 AOP 做日志处理
* 用 AOP 做权限控制，如 Spring Security

<br>

<br>

## 4、AOP中的专业术语

### 4.1、连接点Joinpoint

方法的位置



### 4.2、切点Pointcut

定位方法的条件

每个程序类都拥有多个连接点，如一个拥有两个方法的类，这两个方法都是连接点。

但在这多个连接点中，如何定位到某个感兴趣的连接点上？AOP通过“切点”定位特定连接点。

**类比**：通过数据库查询的概念来理解切点和连接点的关系再适合不过了：连接点相当于数据库中的记录，而切点相当于查询条件。切点和连接点不是一对一的关系，一个切点可以匹配多个连接点。

在 Spring 中，切点通过 PointCut 接口进行描述，它使用类和方法作为连接点的查询条件。

![looper_2020-06-01_19-03-09](image\looper_2020-06-01_19-03-09.png)

<br>

#### 4.2.1、增强Advice

增强是织入到目标类连接点上的一段程序代码。

增强既包含了用于添加到目标连接点上的一段执行逻辑，又包含了用于定位连接点的方位信息，所以SPRING所提供的增强接口都是带方位名的：BeforeAdvice，AfterReturningAdivce，throwsAdvice 等等。

<br>

#### 4.2.2、目标对象Target

增强逻辑的织入的目标类（被代理的目标类）

<br>

#### 4.2.3、引介Introduction

引介是一种特殊的增强，它为类添加一些属性和方法。这样，即使一个业务类原本没有实现某个接口。通过 AOP 的引介功能，我们可以动态地为该业务类添加接口的实例逻辑，让业务类成为这个接口的实现类。

<br>

#### 4.2.4、织入Weaving

织入是将增强添加对目标类具体连接点上的过程。根据不同的实现技术，AOP 有三种织入方式：

* 编译期织入，这要求使用特殊的 Java 编译器 

* 类装载期织入，这要求使用特殊的类加载器

* 动态代理织入，在运行期为目标类添加增强生成的方式（常用）

<br>

#### 4.2.4、代理Proxy

一个类被 AOP 增加后，就产出了一个结果类，它是整合了原类和增强逻辑的代理类。根据不同的代理方式，代理类既可能是和原类具有相同接口的类，也可能就是原类的子类。所以我们可以采用调用原类相同的方式调用代理类。

<br>

#### 4.2.5、切面Aspect

切面由**切点**和**增强（引介）**组成，它既包括了横切逻辑的定义，也包括了连接点的定义，Spring AOP 就是负责实施切面的框架，它将切面所定义的横切逻辑到切面所指定的连接点中。

<br>

<br>

## 5、通知类型

### 5.1、before前置通知

在方法执行前执行，如果通知抛出异常，阻止方法运行

应用：各种校验

<br>

### 5.2、afterReturning后置通知

方法正常返回后执行，如果方法中抛出异常，通知无法执行，必须在方法执行后才执行，所以可以获得方法的返回值

应用：常规数据处理

<br>

### 5.3、around环绕通知

应用：十分强大，可以做任何事情

方法执行前后分别执行，可以阻止方法的执行，必须手动执行目标方法

<br>

### 5.4、afterThrowing抛出异常通知

应用：包装异常信息

方法抛出异常后执行，如果方法没有抛出异常，无法执行

<br>

### 5.5、after最终通知

应用：清理现场

方法执行完毕后执行，无论方法中是否出现异常
